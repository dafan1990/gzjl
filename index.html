<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简工作记录系统</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#007bff',
                        secondary: '#6c757d',
                        success: '#28a745',
                        danger: '#dc3545',
                        warning: '#ffc107',
                        info: '#17a2b8',
                        dark: '#000000',
                        light: '#ffffff'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .transition-all-500 {
                transition: all 0.5s ease;
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
        }

        /* 全局样式 */
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Inter', system-ui, sans-serif;
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #111;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* 输入框焦点样式 */
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        /* 打字效果闪烁光标 */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* 卡片悬停效果 */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* 按钮悬停效果 */
        .btn-hover {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .btn-hover:hover::before {
            left: 100%;
        }

        /* 文字渐入动画 */
        .text-reveal {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
        }

        .text-reveal.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        /* 鼠标跟随效果容器 */
        #mouse-follow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        /* 鼠标跟随粒子 */
        .mouse-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: particle-float 2s ease-out forwards;
        }

        @keyframes particle-float {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }
    </style>
</head>
<body class="min-h-screen bg-black text-white">
    <!-- 鼠标跟随效果容器 -->
    <div id="mouse-follow-container"></div>

    <!-- 主容器 -->
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- 头部区域 -->
        <header class="py-8 border-b border-gray-800">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0">
                <div>
                    <h1 class="text-3xl font-light">
                        极简<span class="text-primary">工作</span>记录
                        <span id="typing-text" class="typing-cursor"></span>
                    </h1>
                    <p class="text-gray-400 text-sm mt-1">记录每一个工作瞬间</p>
                </div>
                
                <!-- 数据管理按钮 -->
                <div class="flex space-x-3">
                    <button id="import-data-btn" class="px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg text-sm btn-hover transition-all-300">
                        <i class="fa fa-upload mr-2"></i>导入
                    </button>
                    <button id="export-data-btn" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-lg text-sm btn-hover transition-all-300">
                        <i class="fa fa-download mr-2"></i>导出
                    </button>
                </div>
            </div>
        </header>

        <!-- 导航菜单 -->
        <nav class="py-4 border-b border-gray-800">
            <div class="flex space-x-6">
                <button id="nav-dashboard" class="nav-btn px-3 py-2 text-white hover:text-primary transition-all-300 border-b-2 border-transparent hover:border-primary cursor-pointer">
                    <i class="fa fa-home mr-2"></i>工作台
                </button>
                <button id="nav-add-log" class="nav-btn px-3 py-2 text-white hover:text-primary transition-all-300 border-b-2 border-transparent hover:border-primary cursor-pointer">
                    <i class="fa fa-plus mr-2"></i>添加记录
                </button>
                <button id="nav-reports" class="nav-btn px-3 py-2 text-white hover:text-primary transition-all-300 border-b-2 border-transparent hover:border-primary cursor-pointer">
                    <i class="fa fa-bar-chart mr-2"></i>数据报告
                </button>
            </div>
        </nav>

        <!-- 页面内容区域 -->
        <main class="py-8">
            <!-- 工作台页面 -->
            <div id="dashboard-page" class="page active">
                <!-- 统计卡片 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gray-900 rounded-lg p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">总记录数</p>
                                <h3 id="total-logs" class="text-3xl font-light mt-2">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center">
                                <i class="fa fa-file-text-o text-blue-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-900 rounded-lg p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">本月记录</p>
                                <h3 id="month-logs" class="text-3xl font-light mt-2">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center">
                                <i class="fa fa-calendar text-green-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-900 rounded-lg p-6 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">平均记录数</p>
                                <h3 id="avg-logs" class="text-3xl font-light mt-2">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-purple-500/20 rounded-full flex items-center justify-center">
                                <i class="fa fa-line-chart text-purple-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 快速筛选 -->
                <div class="bg-gray-900 rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-light mb-4">快速筛选</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">日期</label>
                            <input type="date" id="filter-date" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">关键词</label>
                            <input type="text" id="filter-keyword" placeholder="搜索标题或描述..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                        </div>
                        <div class="flex items-end space-x-3">
                            <button id="filter-btn" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-lg btn-hover transition-all-300">
                                <i class="fa fa-search mr-2"></i>筛选
                            </button>
                            <button id="clear-filter-btn" class="px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg btn-hover transition-all-300">
                                <i class="fa fa-refresh mr-2"></i>清空
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 工作记录表格 -->
                <div class="bg-gray-900 rounded-lg overflow-hidden">
                    <div class="p-6 border-b border-gray-800">
                        <h3 class="text-lg font-light">工作记录列表</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-800">
                                    <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">日期</th>
                                    <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">标题</th>
                                    <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">描述</th>
                                    <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">标签</th>
                                    <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">操作</th>
                                </tr>
                            </thead>
                            <tbody id="worklogs-table">
                                <!-- 工作记录将在这里动态生成 -->
                                <tr>
                                    <td colspan="4" class="py-8 text-center text-gray-400">
                                        <i class="fa fa-inbox text-4xl mb-3"></i>
                                        <p>暂无工作记录</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 添加记录页面 -->
            <div id="add-log-page" class="page hidden">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-light mb-6 text-reveal">添加工作记录</h2>
                    
                    <form id="work-log-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-400 text-sm mb-2">日期 <span class="text-red-500">*</span></label>
                                <input type="date" id="log-date" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                            </div>

                        </div>
                        
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">标题 <span class="text-red-500">*</span></label>
                            <input type="text" id="log-title" required placeholder="简要描述工作内容..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                        </div>
                        
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">详细描述</label>
                            <textarea id="log-description" rows="4" placeholder="详细记录工作过程、成果和遇到的问题..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">标签</label>
                            <input type="text" id="log-tags" placeholder="用逗号分隔，例如：开发,设计,会议" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                        </div>
                        
                        <div>
                            <label class="block text-gray-400 text-sm mb-2">图片</label>
                            <div class="space-y-3">
                                <input type="file" id="log-images" multiple accept="image/*" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:bg-gray-700 file:border-0 file:text-white hover:file:bg-gray-600 cursor-pointer">
                                <div id="image-preview" class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-2"></div>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-4">
                            <button type="button" id="cancel-btn" class="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-lg btn-hover transition-all-300 cursor-pointer">
                                取消
                            </button>
                            <button type="submit" class="px-6 py-3 bg-primary hover:bg-blue-600 text-white rounded-lg btn-hover transition-all-300">
                                <i class="fa fa-save mr-2"></i>保存记录
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 数据报告页面 -->
            <div id="reports-page" class="page hidden">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-light mb-6 text-reveal">数据统计报告</h2>
                    
                    <!-- 报告筛选 -->
                    <div class="bg-gray-900 rounded-lg p-6 mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-400 text-sm mb-2">开始日期</label>
                                <input type="date" id="report-start-date" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-400 text-sm mb-2">结束日期</label>
                                <input type="date" id="report-end-date" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                            </div>
                            <div class="flex items-end">
                                <button id="generate-report-btn" class="w-full px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-lg btn-hover transition-all-300">
                                    <i class="fa fa-bar-chart mr-2"></i>自定义报告
                                </button>
                            </div>
                        </div>
                        
                        <!-- 定期报告按钮 -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <button onclick="generatePeriodReport('daily')" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg text-sm btn-hover transition-all-300">
                                <i class="fa fa-calendar-day mr-2"></i>日报
                            </button>
                            <button onclick="generatePeriodReport('weekly')" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg text-sm btn-hover transition-all-300">
                                <i class="fa fa-calendar-week mr-2"></i>周报
                            </button>
                            <button onclick="generatePeriodReport('monthly')" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg text-sm btn-hover transition-all-300">
                                <i class="fa fa-calendar-alt mr-2"></i>月报
                            </button>
                            <button onclick="generatePeriodReport('yearly')" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg text-sm btn-hover transition-all-300">
                                <i class="fa fa-calendar-check mr-2"></i>年度总结
                            </button>
                        </div>
                    </div>
                    
                    <!-- 图表区域 -->
                    <div id="report-content" class="hidden">

                        <!-- 日报生成和AI优化 -->
                        <div class="bg-gray-900 rounded-lg p-6 mb-8">
                            <h3 class="text-lg font-light mb-4">日报生成与优化</h3>
                            <div class="space-y-4">
                                <div class="flex space-x-3 items-center">
                                    <button id="generate-daily-report-btn" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-lg btn-hover transition-all-300">
                                        <i class="fa fa-file-text-o mr-2"></i>生成报告
                                    </button>
                                    <button id="optimize-report-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg btn-hover transition-all-300" disabled>
                                        <i class="fa fa-magic mr-2"></i>AI优化
                                    </button>
                                    <select id="export-format" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white">
                                        <option value="md">Markdown (.md)</option>
                                        <option value="word">Word (.docx)</option>
                                        <option value="excel">Excel (.csv)</option>
                                    </select>
                                    <button id="export-report-btn" class="px-4 py-2 bg-success hover:bg-success/90 text-white rounded-lg btn-hover transition-all-300" disabled>
                                        <i class="fa fa-download mr-2"></i>导出报告
                                    </button>
                                </div>
                                
                                <!-- AI API 设置 -->
                                <div class="space-y-3">
                                    <div class="flex flex-wrap gap-3">
                                        <button id="toggle-api-key" class="text-sm text-primary hover:text-primary/80 transition-colors">
                                            <i class="fa fa-cog mr-1"></i>AI 设置
                                        </button>
                                        <span class="text-xs text-gray-500">支持豆包AI和OpenAI，可调用互联网AI服务</span>
                                    </div>
                                    <div id="api-key-section" class="hidden bg-gray-800/50 rounded-lg p-4">
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-gray-400 text-sm mb-2">AI服务提供商</label>
                                                <select id="ai-provider" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white">
                                                    <option value="doubao">豆包AI</option>
                                                    <option value="openai">OpenAI</option>
                                                </select>
                                            </div>
                                            
                                            <!-- 豆包API Key设置 -->
                                            <div id="doubao-api-key-section" class="hidden">
                                                <label class="block text-gray-400 text-sm mb-2">豆包API Key</label>
                                                <input type="password" id="doubao-api-key" placeholder="输入豆包API Key..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                                                <div class="flex items-center gap-2 mt-2">
                                                    <button id="save-doubao-key" class="text-xs bg-primary/20 text-primary px-3 py-1 rounded-lg hover:bg-primary/30 transition-colors">
                                                        保存API Key
                                                    </button>
                                                    <p class="text-gray-500 text-xs">
                                                        <a href="https://www.doubao.com/developer" target="_blank" class="text-primary hover:underline">获取免费API Key</a>
                                                    </p>
                                                </div>
                                            </div>
                                            
                                            <!-- OpenAI API Key设置 -->
                                            <div id="openai-api-key-section" class="hidden">
                                                <label class="block text-gray-400 text-sm mb-2">OpenAI API Key</label>
                                                <input type="password" id="openai-api-key" placeholder="输入OpenAI API Key..." class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                                                <div class="flex items-center gap-2 mt-2">
                                                    <button id="save-openai-key" class="text-xs bg-primary/20 text-primary px-3 py-1 rounded-lg hover:bg-primary/30 transition-colors">
                                                        保存API Key
                                                    </button>
                                                    <p class="text-gray-500 text-xs">
                                                        <a href="https://platform.openai.com/api-keys" target="_blank" class="text-primary hover:underline">获取API Key</a>
                                                    </p>
                                                </div>
                                            </div>
                                            
                                            <!-- AI服务说明 -->
                                            <div id="ai-service-info" class="bg-blue-500/20 border border-blue-500/30 rounded-lg p-3">
                                                <p class="text-sm text-blue-300">
                                                    <i class="fa fa-info-circle mr-1"></i>
                                                    选择AI服务提供商并保存API Key后，点击"AI优化"即可调用互联网AI服务。
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 报告内容 -->
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <h4 class="text-md font-medium text-gray-300">报告内容</h4>
                                        <div class="flex items-center gap-3">
                                            <select id="report-type" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1 text-sm text-white">
                                                <option value="daily">日报</option>
                                                <option value="weekly">周报</option>
                                                <option value="monthly">月报</option>
                                                <option value="project">项目总结</option>
                                            </select>
                                            <!-- API调用状态指示器 -->
                                            <div id="api-status" class="hidden items-center gap-2 text-xs">
                                                <i id="status-icon" class="fa fa-circle text-gray-500"></i>
                                                <span id="status-text">准备就绪</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-gray-800 rounded-lg p-4 min-h-[600px] h-auto">
                                        <textarea id="daily-report-content" class="w-full min-h-[600px] h-full bg-transparent text-white resize-y focus:outline-none text-base leading-relaxed" placeholder="点击生成日报按钮，将根据所选日期范围生成结构化的报告内容..."></textarea>
                                    </div>
                                    <!-- 调试信息面板 -->
                                    <div id="debug-panel" class="bg-gray-800/50 rounded-lg p-4 hidden">
                                        <h5 class="text-sm font-medium text-gray-300 mb-2 flex items-center gap-2">
                                            <i class="fa fa-bug"></i>
                                            调试信息
                                            <button id="toggle-debug" class="ml-auto text-xs text-primary hover:text-primary/80">
                                                收起
                                            </button>
                                        </h5>
                                        <pre id="debug-info" class="text-xs text-gray-400 bg-gray-900 rounded p-3 overflow-x-auto whitespace-pre-wrap max-h-[200px]">准备就绪</pre>
                                    </div>
                                    <!-- 调试按钮 -->
                                    <div class="flex justify-end">
                                        <button id="show-debug" class="text-xs text-gray-500 hover:text-gray-300 transition-colors">
                                            <i class="fa fa-bug mr-1"></i>显示调试信息
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 工作内容分布 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div class="bg-gray-900 rounded-lg p-6">
                                <h3 class="text-lg font-light mb-4">工作内容分布</h3>
                                <div class="h-64">
                                    <canvas id="content-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-gray-900 rounded-lg p-6">
                                <h3 class="text-lg font-light mb-4">每日工作记录数</h3>
                                <div class="h-64">
                                    <canvas id="daily-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 详细数据表格 -->
                        <div class="bg-gray-900 rounded-lg overflow-hidden">
                            <div class="p-6 border-b border-gray-800">
                                <h3 class="text-lg font-light">详细数据</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-800">
                                            <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">日期</th>
                                            <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">标题</th>
                                            <th class="py-4 px-6 text-left text-sm font-medium text-gray-400">标签</th>
                                        </tr>
                                    </thead>
                                    <tbody id="report-table">
                                        <!-- 报告数据将在这里动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 空状态 -->
                    <div id="report-empty" class="text-center py-16">
                        <i class="fa fa-bar-chart text-6xl text-gray-700 mb-4"></i>
                        <p class="text-gray-400">选择日期范围并生成报告</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- 页脚 -->
        <footer class="py-6 border-t border-gray-800 text-center text-gray-500 text-sm">
            <p>&copy; 2024 极简工作记录系统 | 专注记录每一个工作瞬间</p>
        </footer>
    </div>

    <!-- Toast 提示 -->
    <div id="toast" class="fixed top-4 right-4 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50 glass-effect">
        <span id="toast-message"></span>
    </div>

    <script>
        // 全局变量
        let worklogs = JSON.parse(localStorage.getItem('minimal_worklogs')) || [];
        let currentReport = null;
        let contentChart = null;
        let dailyChart = null;

        // DOM 加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('log-date').value = today;
            document.getElementById('filter-date').value = today;
            document.getElementById('report-start-date').value = today;
            document.getElementById('report-end-date').value = today;

            // 初始化事件监听
            setupEventListeners();
            
            // 加载工作记录
            renderWorkLogs();
            updateStats();
            
            // 初始化打字效果
            initTypingEffect();
            
            // 初始化鼠标跟随效果
            initMouseFollowEffect();
            
            // 初始化滚动渐入效果
            initScrollReveal();
            
            // 设置默认激活的导航按钮
            document.getElementById('nav-dashboard').classList.add('border-primary');
            
            // 显示欢迎提示
            setTimeout(() => {
                showToast('欢迎使用极简工作记录系统！');
            }, 500);
        });

        // 设置事件监听
        function setupEventListeners() {
            try {
                console.log('正在设置事件监听器...');
                
                // 工作记录表单提交
                const workLogForm = document.getElementById('work-log-form');
                if (workLogForm) {
                    workLogForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        console.log('表单提交');
                        saveWorkLog();
                    });
                } else {
                    console.error('未找到工作记录表单');
                }

                // 筛选按钮
                const filterBtn = document.getElementById('filter-btn');
                if (filterBtn) {
                    filterBtn.addEventListener('click', function() {
                        console.log('筛选按钮点击');
                        applyFilter();
                    });
                } else {
                    console.error('未找到筛选按钮');
                }

                const clearFilterBtn = document.getElementById('clear-filter-btn');
                if (clearFilterBtn) {
                    clearFilterBtn.addEventListener('click', function() {
                        console.log('清空筛选按钮点击');
                        clearFilter();
                    });
                } else {
                    console.error('未找到清空筛选按钮');
                }

                // 报告生成按钮
                const generateReportBtn = document.getElementById('generate-report-btn');
                if (generateReportBtn) {
                    generateReportBtn.addEventListener('click', function() {
                        console.log('生成报告按钮点击');
                        generateReport();
                    });
                } else {
                    console.error('未找到生成报告按钮');
                }

                // 日报生成按钮
                const generateDailyReportBtn = document.getElementById('generate-daily-report-btn');
                if (generateDailyReportBtn) {
                    generateDailyReportBtn.addEventListener('click', function() {
                        console.log('生成日报按钮点击');
                        generateDailyReport();
                    });
                }

                // AI优化按钮
                const optimizeReportBtn = document.getElementById('optimize-report-btn');
                if (optimizeReportBtn) {
                    optimizeReportBtn.addEventListener('click', function() {
                        console.log('AI优化按钮点击');
                        optimizeReport();
                    });
                }

                // 导出日报按钮
                const exportReportBtn = document.getElementById('export-report-btn');
                if (exportReportBtn) {
                    exportReportBtn.addEventListener('click', function() {
                        console.log('导出日报按钮点击');
                        exportReport();
                    });
                }

                // 切换API Key显示/隐藏
                const toggleApiKeyBtn = document.getElementById('toggle-api-key');
                if (toggleApiKeyBtn) {
                    toggleApiKeyBtn.addEventListener('click', function() {
                        const apiKeySection = document.getElementById('api-key-section');
                        apiKeySection.classList.toggle('hidden');
                    });
                }

                // 服务提供商切换
                const aiProviderSelect = document.getElementById('ai-provider');
                if (aiProviderSelect) {
                    aiProviderSelect.addEventListener('change', function() {
                        const selectedProvider = this.value;
                        const openaiSection = document.getElementById('openai-api-key-section');
                        const doubaoSection = document.getElementById('doubao-api-key-section');
                        
                        if (selectedProvider === 'openai') {
                            openaiSection.classList.remove('hidden');
                            doubaoSection.classList.add('hidden');
                        } else {
                            openaiSection.classList.add('hidden');
                            doubaoSection.classList.remove('hidden');
                        }
                    });
                    
                    // 初始触发一次，设置正确的显示状态
                    aiProviderSelect.dispatchEvent(new Event('change'));
                }

                // 加载保存的API Key
                document.getElementById('doubao-api-key').value = localStorage.getItem('minimal_workflow_doubao_api_key') || '';
                document.getElementById('openai-api-key').value = localStorage.getItem('minimal_workflow_openai_api_key') || '';

                // 保存豆包API Key
                const saveDoubaoKeyBtn = document.getElementById('save-doubao-key');
                if (saveDoubaoKeyBtn) {
                    saveDoubaoKeyBtn.addEventListener('click', function() {
                        const apiKey = document.getElementById('doubao-api-key').value;
                        if (apiKey) {
                            localStorage.setItem('minimal_workflow_doubao_api_key', apiKey);
                            showToast('豆包API Key保存成功！');
                        } else {
                            showToast('请输入API Key！', 'error');
                        }
                    });
                }

                // 保存OpenAI API Key
                const saveOpenaiKeyBtn = document.getElementById('save-openai-key');
                if (saveOpenaiKeyBtn) {
                    saveOpenaiKeyBtn.addEventListener('click', function() {
                        const apiKey = document.getElementById('openai-api-key').value;
                        if (apiKey) {
                            localStorage.setItem('minimal_workflow_openai_api_key', apiKey);
                            showToast('OpenAI API Key保存成功！');
                            // 添加调试日志
                            addDebugLog(`已保存OpenAI API Key: ${apiKey.substring(0, 10)}...`);
                        } else {
                            showToast('请输入API Key！', 'error');
                            addDebugLog('保存OpenAI API Key失败：请输入API Key');
                        }
                    });
                }

                // 调试面板功能
                const showDebugBtn = document.getElementById('show-debug');
                const toggleDebugBtn = document.getElementById('toggle-debug');
                const debugPanel = document.getElementById('debug-panel');
                
                if (showDebugBtn) {
                    showDebugBtn.addEventListener('click', function() {
                        debugPanel.classList.remove('hidden');
                        this.classList.add('hidden');
                    });
                }
                
                if (toggleDebugBtn) {
                    toggleDebugBtn.addEventListener('click', function() {
                        debugPanel.classList.add('hidden');
                        document.getElementById('show-debug').classList.remove('hidden');
                    });
                }

                // 数据管理按钮
                const exportDataBtn = document.getElementById('export-data-btn');
                if (exportDataBtn) {
                    exportDataBtn.addEventListener('click', function() {
                        console.log('导出数据按钮点击');
                        exportData();
                    });
                } else {
                    console.error('未找到导出数据按钮');
                }

                const importDataBtn = document.getElementById('import-data-btn');
                if (importDataBtn) {
                    importDataBtn.addEventListener('click', function() {
                        console.log('导入数据按钮点击');
                        importData();
                    });
                } else {
                    console.error('未找到导入数据按钮');
                }

                // 导航按钮
                const navDashboard = document.getElementById('nav-dashboard');
                const navAddLog = document.getElementById('nav-add-log');
                const navReports = document.getElementById('nav-reports');
                
                if (navDashboard) {
                    navDashboard.addEventListener('click', function() {
                        console.log('导航到工作台');
                        switchPage('dashboard');
                    });
                }
                
                if (navAddLog) {
                    navAddLog.addEventListener('click', function() {
                        console.log('导航到添加记录');
                        switchPage('add-log');
                    });
                }
                
                if (navReports) {
                    navReports.addEventListener('click', function() {
                        console.log('导航到数据报告');
                        switchPage('reports');
                    });
                }
                
                // 导航按钮样式
                const navBtns = document.querySelectorAll('.nav-btn');
                console.log('找到导航按钮数量:', navBtns.length);
                navBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // 移除所有按钮的激活状态
                        navBtns.forEach(b => {
                            b.classList.remove('border-primary');
                            b.classList.add('border-transparent');
                        });
                        // 激活当前按钮
                        this.classList.remove('border-transparent');
                        this.classList.add('border-primary');
                    });
                });

                // 取消按钮
                const cancelBtn = document.getElementById('cancel-btn');
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', function() {
                        console.log('取消按钮点击');
                        switchPage('dashboard');
                    });
                } else {
                    console.error('未找到取消按钮');
                }
                
                // 图片上传和预览
                const imageInput = document.getElementById('log-images');
                const imagePreview = document.getElementById('image-preview');
                
                if (imageInput && imagePreview) {
                    imageInput.addEventListener('change', function(e) {
                        handleImageUpload(e);
                    });
                }

                // 定期报告按钮
                const periodReportBtns = document.querySelectorAll('[onclick^="generatePeriodReport"]');
                console.log('找到定期报告按钮数量:', periodReportBtns.length);
                periodReportBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        console.log('定期报告按钮点击:', this.textContent.trim());
                    });
                });

                console.log('事件监听器设置完成');
            } catch (error) {
                console.error('设置事件监听器时出错:', error);
            }
        }

        // 切换页面
        function switchPage(pageId) {
            try {
                // 隐藏所有页面
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.add('hidden');
                    page.classList.remove('active');
                });

                // 显示目标页面
                const targetPage = document.getElementById(pageId + '-page');
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                    targetPage.classList.add('active');
                } else {
                    console.error('页面未找到:', pageId + '-page');
                }

                // 如果切换到报告页面，重新生成图表
                if (pageId === 'reports' && currentReport) {
                    setTimeout(() => {
                        renderCharts();
                    }, 100);
                }
            } catch (error) {
                console.error('切换页面时出错:', error);
            }
        }

        // 图片上传处理函数
        function handleImageUpload(event) {
            const files = event.target.files;
            const previewContainer = document.getElementById('image-preview');
            previewContainer.innerHTML = '';
            
            // 限制最多上传5张图片
            const maxImages = 5;
            const selectedFiles = Array.from(files).slice(0, maxImages);
            
            selectedFiles.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'relative group';
                        
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'w-full h-40 object-cover rounded-lg border border-gray-700';
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'absolute top-2 right-2 bg-red-600 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200';
                        removeBtn.innerHTML = '<i class="fa fa-times"></i>';
                        removeBtn.onclick = function() {
                            previewItem.remove();
                            // 重新构建文件列表
                            const updatedFiles = Array.from(previewContainer.querySelectorAll('img'));
                            const dataTransfer = new DataTransfer();
                            updatedFiles.forEach((img, index) => {
                                // 这里我们只保留预览，文件会在提交时重新读取
                            });
                            event.target.files = dataTransfer.files;
                        };
                        
                        previewItem.appendChild(img);
                        previewItem.appendChild(removeBtn);
                        previewContainer.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // 保存工作记录
        function saveWorkLog() {
            const date = document.getElementById('log-date').value;
            const title = document.getElementById('log-title').value.trim();
            const description = document.getElementById('log-description').value.trim();
            const tags = document.getElementById('log-tags').value.trim();
            const imageInput = document.getElementById('log-images');
            
            if (!date || !title) {
                showToast('请填写必填字段！', 'error');
                return;
            }
            
            // 处理图片上传
            const images = [];
            const files = imageInput.files;
            const maxImages = 5;
            const selectedFiles = Array.from(files).slice(0, maxImages);
            
            // 使用Promise处理图片读取
            const imagePromises = selectedFiles.map(file => {
                return new Promise((resolve) => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            images.push({
                                name: file.name,
                                type: file.type,
                                data: e.target.result,
                                size: file.size
                            });
                            resolve();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        resolve();
                    }
                });
            });
            
            // 等待所有图片处理完成
            Promise.all(imagePromises).then(() => {
                // 创建工作记录对象
                const worklog = {
                    id: Date.now().toString(),
                    date,
                    title,
                    description,
                    tags: tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag) : [],
                    images: images,
                    createdAt: new Date().toISOString()
                };

                // 添加到数组并保存
                worklogs.push(worklog);
                localStorage.setItem('minimal_worklogs', JSON.stringify(worklogs));

                // 重新渲染和更新统计
                renderWorkLogs();
                updateStats();

                // 重置表单
                document.getElementById('work-log-form').reset();
                document.getElementById('log-date').value = date;
                document.getElementById('image-preview').innerHTML = '';

                showToast('工作记录保存成功！');
                switchPage('dashboard');
            });
        }

        // 删除工作记录
        function deleteWorkLog(id) {
            if (confirm('确定要删除这条工作记录吗？')) {
                worklogs = worklogs.filter(log => log.id !== id);
                localStorage.setItem('minimal_worklogs', JSON.stringify(worklogs));
                renderWorkLogs();
                updateStats();
                showToast('工作记录已删除！');
            }
        }

        // 渲染工作记录表格
        function renderWorkLogs(filteredLogs = null) {
            const logsToRender = filteredLogs || worklogs;
            const tableBody = document.getElementById('worklogs-table');
            
            // 清空表格
            tableBody.innerHTML = '';
            
            if (logsToRender.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="py-8 text-center text-gray-400">
                            <i class="fa fa-inbox text-4xl mb-3"></i>
                            <p>暂无工作记录</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // 按日期降序排序
            const sortedLogs = [...logsToRender].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // 生成表格行
            sortedLogs.forEach(log => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-800 hover:bg-gray-800/50 transition-all-300';
                
                const tagsHtml = log.tags && log.tags.length > 0 ? 
                    `<div class="flex flex-wrap gap-1 mt-1">
                        ${log.tags.map(tag => `<span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded-full text-xs">${tag}</span>`).join('')}
                    </div>` : '';
                
                // 生成图片预览HTML
                const imagesHtml = log.images && log.images.length > 0 ? 
                    `<div class="flex flex-wrap gap-1 mt-1">
                        ${log.images.slice(0, 3).map((image, index) => `
                            <div class="relative group">
                                <img src="${image.data}" alt="图片 ${index + 1}" 
                                     class="w-10 h-10 object-cover rounded-md cursor-pointer hover:opacity-80 transition-opacity-300"
                                     onclick="showImageModal('${image.data}', '${image.name}')">
                                ${log.images.length > 3 && index === 2 ? 
                                    `<div class="absolute inset-0 bg-gray-900/70 flex items-center justify-center rounded-md text-white text-xs font-medium">
                                        +${log.images.length - 3}
                                    </div>` : ''}
                            </div>
                        `).join('')}
                    </div>` : '';
                
                row.innerHTML = `
                    <td class="py-4 px-6 text-sm text-gray-300">${log.date}</td>
                    <td class="py-4 px-6">
                        <div class="font-medium text-white">${log.title}</div>
                        ${log.description ? `<div class="text-gray-400 text-sm mt-1 line-clamp-2">${log.description}</div>` : ''}
                        ${imagesHtml}
                    </td>
                    <td class="py-4 px-6">
                        ${tagsHtml || '<span class="text-gray-500">-</span>'}
                    </td>
                    <td class="py-4 px-6 text-sm">
                        <button class="text-red-400 hover:text-red-300 transition-all-300" onclick="deleteWorkLog('${log.id}')">
                            <i class="fa fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 更新统计数据
        function updateStats() {
            const totalLogs = worklogs.length;
            const today = new Date();
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            const monthLogs = worklogs.filter(log => new Date(log.date) >= monthStart).length;
            
            // 计算日均记录数
            let avgLogs = 0;
            if (totalLogs > 0) {
                const firstLogDate = new Date(Math.min(...worklogs.map(log => new Date(log.date))));
                const daysDiff = Math.ceil((today - firstLogDate) / (1000 * 60 * 60 * 24)) + 1;
                avgLogs = (totalLogs / daysDiff).toFixed(1);
            }

            document.getElementById('total-logs').textContent = totalLogs;
            document.getElementById('month-logs').textContent = monthLogs;
            document.getElementById('avg-logs').textContent = avgLogs;
        }

        // 应用筛选
        function applyFilter() {
            const date = document.getElementById('filter-date').value;
            const keyword = document.getElementById('filter-keyword').value.trim().toLowerCase();
            
            let filtered = worklogs;
            
            if (date) {
                filtered = filtered.filter(log => log.date === date);
            }
            
            if (keyword) {
                filtered = filtered.filter(log => 
                    log.title.toLowerCase().includes(keyword) || 
                    log.description.toLowerCase().includes(keyword) ||
                    (log.tags && log.tags.some(tag => tag.toLowerCase().includes(keyword)))
                );
            }
            
            renderWorkLogs(filtered);
        }

        // 清空筛选
        function clearFilter() {
            document.getElementById('filter-date').value = '';
            document.getElementById('filter-keyword').value = '';
            renderWorkLogs();
        }

        // 生成报告
        function generateReport() {
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            
            if (!startDate || !endDate) {
                showToast('请选择日期范围！', 'error');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                showToast('开始日期不能晚于结束日期！', 'error');
                return;
            }
            
            // 筛选日期范围内的记录
            const filteredLogs = worklogs.filter(log => {
                const logDate = new Date(log.date);
                return logDate >= new Date(startDate) && logDate <= new Date(endDate);
            });
            
            if (filteredLogs.length === 0) {
                showToast('所选日期范围内没有工作记录！', 'warning');
                return;
            }
            
            currentReport = {
                startDate,
                endDate,
                logs: filteredLogs
            };
            
            // 显示报告内容
            document.getElementById('report-empty').classList.add('hidden');
            document.getElementById('report-content').classList.remove('hidden');
            
            // 渲染图表和表格
            renderCharts();
            renderReportTable();
            
            showToast('报告生成成功！');
        }

        // 渲染图表
        function renderCharts() {
            if (!currentReport) return;
            
            const { logs } = currentReport;
            
            // 销毁现有图表
            if (contentChart) contentChart.destroy();
            if (dailyChart) dailyChart.destroy();
            
            // 准备数据
            const dailyData = prepareDailyData(logs);
            const contentData = prepareContentData(logs);
            
            // 工作内容分布图表
            const contentCtx = document.getElementById('content-chart').getContext('2d');
            contentChart = new Chart(contentCtx, {
                type: 'doughnut',
                data: {
                    labels: contentData.labels,
                    datasets: [{
                        data: contentData.data,
                        backgroundColor: [
                            '#007bff', '#28a745', '#dc3545', '#ffc107', 
                            '#17a2b8', '#6f42c1', '#fd7e14', '#e83e8c'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#999',
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
            
            // 每日工作记录数图表
            const dailyCtx = document.getElementById('daily-chart').getContext('2d');
            dailyChart = new Chart(dailyCtx, {
                type: 'bar',
                data: {
                    labels: dailyData.labels,
                    datasets: [{
                        label: '记录数',
                        data: dailyData.counts,
                        backgroundColor: 'rgba(0, 123, 255, 0.6)',
                        borderColor: 'rgba(0, 123, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#999'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#999',
                                stepSize: 1
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // 准备每日数据
        function prepareDailyData(logs) {
            const dailyMap = new Map();
            
            logs.forEach(log => {
                if (!dailyMap.has(log.date)) {
                    dailyMap.set(log.date, { count: 0 });
                }
                dailyMap.get(log.date).count += 1;
            });
            
            const sortedDates = Array.from(dailyMap.keys()).sort();
            const counts = sortedDates.map(date => dailyMap.get(date).count);
            
            return {
                labels: sortedDates.map(date => {
                    const d = new Date(date);
                    return `${d.getMonth() + 1}/${d.getDate()}`;
                }),
                counts
            };
        }

        // 准备内容分布数据
        function prepareContentData(logs) {
            const titleMap = new Map();
            
            logs.forEach(log => {
                const title = log.title.length > 10 ? log.title.substring(0, 10) + '...' : log.title;
                titleMap.set(title, (titleMap.get(title) || 0) + 1);
            });
            
            // 只显示前8个最常见的标题
            const sorted = Array.from(titleMap.entries())
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);
            
            return {
                labels: sorted.map(([title]) => title),
                data: sorted.map(([, count]) => count)
            };
        }

        // 渲染报告表格
        function renderReportTable() {
            if (!currentReport) return;
            
            const tableBody = document.getElementById('report-table');
            tableBody.innerHTML = '';
            
            const sortedLogs = [...currentReport.logs].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedLogs.forEach(log => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-800 hover:bg-gray-800/50 transition-all-300';
                
                const tagsHtml = log.tags && log.tags.length > 0 ? 
                    log.tags.map(tag => `<span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded-full text-xs">${tag}</span>`).join('') : 
                    '-';
                
                row.innerHTML = `
                    <td class="py-4 px-6 text-sm text-gray-300">${log.date}</td>
                    <td class="py-4 px-6 text-sm text-white">${log.title}</td>
                    <td class="py-4 px-6 text-sm">${tagsHtml || '<span class="text-gray-500">-</span>'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 导出数据
        function exportData() {
            const data = {
                worklogs: worklogs,
                exportDate: new Date().toISOString()
            };
            
            // 创建下载链接
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workflow_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('数据导出成功！');
        }

        // 导入数据
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // 验证数据格式
                        if (!data.worklogs || !Array.isArray(data.worklogs)) {
                            showToast('数据格式不正确！', 'error');
                            return;
                        }
                        
                        // 合并数据（避免覆盖现有数据）
                        const importedWorklogs = data.worklogs;
                        const existingIds = new Set(worklogs.map(log => log.id));
                        
                        // 转换旧数据格式（移除hours字段）
                        const newWorklogs = importedWorklogs
                            .filter(log => !existingIds.has(log.id))
                            .map(log => {
                                const { hours, ...newLog } = log;
                                return newLog;
                            });
                        
                        if (newWorklogs.length === 0) {
                            showToast('没有新数据需要导入！', 'warning');
                            return;
                        }
                        
                        // 添加新数据
                        worklogs = worklogs.concat(newWorklogs);
                        localStorage.setItem('minimal_worklogs', JSON.stringify(worklogs));
                        
                        // 重新渲染
                        renderWorkLogs();
                        updateStats();
                        
                        showToast(`成功导入 ${newWorklogs.length} 条记录！`);
                    } catch (error) {
                        showToast('数据解析失败：' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // 显示Toast提示
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            
            // 设置颜色
            if (type === 'error') {
                toast.classList.add('bg-red-500/20', 'border', 'border-red-500/30');
            } else if (type === 'warning') {
                toast.classList.add('bg-yellow-500/20', 'border', 'border-yellow-500/30');
            } else {
                toast.classList.add('bg-green-500/20', 'border', 'border-green-500/30');
            }
            
            // 显示Toast
            toast.classList.remove('translate-x-full');
            
            // 3秒后隐藏
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                
                // 重置样式
                setTimeout(() => {
                    toast.classList.remove('bg-red-500/20', 'bg-yellow-500/20', 'bg-green-500/20', 'border', 'border-red-500/30', 'border-yellow-500/30', 'border-green-500/30');
                }, 300);
            }, 3000);
        }

        // 打字效果
        function initTypingEffect() {
            const typingText = document.getElementById('typing-text');
            const words = ['高效', '专注', '简洁', '专业'];
            let wordIndex = 0;
            let charIndex = 0;
            let isDeleting = false;
            
            function type() {
                const currentWord = words[wordIndex];
                
                if (isDeleting) {
                    typingText.textContent = currentWord.substring(0, charIndex - 1);
                    charIndex--;
                } else {
                    typingText.textContent = currentWord.substring(0, charIndex + 1);
                    charIndex++;
                }
                
                if (!isDeleting && charIndex === currentWord.length) {
                    isDeleting = true;
                    setTimeout(type, 1000);
                } else if (isDeleting && charIndex === 0) {
                    isDeleting = false;
                    wordIndex = (wordIndex + 1) % words.length;
                    setTimeout(type, 500);
                } else {
                    setTimeout(type, isDeleting ? 50 : 100);
                }
            }
            
            type();
        }

        // 鼠标跟随效果
        function initMouseFollowEffect() {
            const container = document.getElementById('mouse-follow-container');
            let isActive = true;
            
            document.addEventListener('mousemove', (e) => {
                if (!isActive) return;
                
                const x = e.clientX;
                const y = e.clientY;
                
                // 随机生成粒子
                if (Math.random() > 0.7) {
                    createParticle(x, y);
                }
            });
            
            function createParticle(x, y) {
                const particle = document.createElement('div');
                particle.className = 'mouse-particle';
                
                // 随机大小和位置偏移
                const size = Math.random() * 4 + 2;
                const offsetX = (Math.random() - 0.5) * 20;
                const offsetY = (Math.random() - 0.5) * 20;
                
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.left = (x + offsetX) + 'px';
                particle.style.top = (y + offsetY) + 'px';
                
                // 随机颜色
                const colors = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.background = color;
                
                // 随机移动方向
                const tx = (Math.random() - 0.5) * 100;
                const ty = (Math.random() - 0.5) * 100;
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                
                container.appendChild(particle);
                
                // 动画结束后移除
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 2000);
            }
            
            // 禁用移动端的鼠标跟随效果
            if (window.innerWidth <= 768) {
                isActive = false;
            }
        }

        // 滚动渐入效果
        function initScrollReveal() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('revealed');
                    }
                });
            }, observerOptions);
            
            // 观察所有带有text-reveal类的元素
            document.querySelectorAll('.text-reveal').forEach(el => {
                observer.observe(el);
            });
        }

        // 生成定期报告
        function generatePeriodReport(period) {
            try {
                const today = new Date();
                let startDate, endDate;
                
                switch(period) {
                    case 'daily':
                        // 今天
                        startDate = new Date(today);
                        endDate = new Date(today);
                        break;
                    case 'weekly':
                        // 本周（周一到今天）
                        const dayOfWeek = today.getDay();
                        const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // 调整为周一
                        startDate = new Date(today.setDate(diff));
                        today.setDate(today.getDate() + dayOfWeek - 1); // 回到今天
                        endDate = new Date(today);
                        break;
                    case 'monthly':
                        // 本月
                        startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                        endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                        break;
                    case 'yearly':
                        // 本年
                        startDate = new Date(today.getFullYear(), 0, 1);
                        endDate = new Date(today.getFullYear(), 11, 31);
                        break;
                    default:
                        showToast('无效的报告周期！', 'error');
                        return;
                }
                
                // 设置日期输入框
                const formatDate = (date) => date.toISOString().split('T')[0];
                document.getElementById('report-start-date').value = formatDate(startDate);
                document.getElementById('report-end-date').value = formatDate(endDate);
                
                // 生成报告
                generateReport();
                
                // 显示提示
                const periodNames = {
                    'daily': '日报',
                    'weekly': '周报',
                    'monthly': '月报',
                    'yearly': '年度总结'
                };
                showToast(`已生成${periodNames[period]}！`);
                
            } catch (error) {
                console.error('生成定期报告时出错:', error);
                showToast('生成报告失败！', 'error');
            }
        }
        
        // 生成报告内容
        function generateDailyReport() {
            if (!currentReport) {
                showToast('请先生成报告！', 'error');
                return;
            }
            
            const { logs, startDate, endDate } = currentReport;
            const reportType = document.getElementById('report-type').value;
            
            // 报告类型名称映射
            const reportTypeNames = {
                'daily': '日报',
                'weekly': '周报',
                'monthly': '月报',
                'project': '项目总结'
            };
            
            // 按日期分组
            const logsByDate = {};
            logs.forEach(log => {
                if (!logsByDate[log.date]) {
                    logsByDate[log.date] = [];
                }
                logsByDate[log.date].push(log);
            });
            
            // 生成报告结构
            let reportContent = `# 工作${reportTypeNames[reportType]}\n\n`;
            reportContent += `**报告日期范围**：${startDate} 至 ${endDate}\n`;
            reportContent += `**总记录数**：${logs.length} 条\n\n`;
            
            // 添加每日工作内容
            Object.keys(logsByDate).sort().forEach(date => {
                const dayLogs = logsByDate[date];
                reportContent += `## ${date}\n\n`;
                
                dayLogs.forEach(log => {
                    reportContent += `### ${log.title}\n`;
                    if (log.description) {
                        reportContent += `${log.description}\n\n`;
                    }
                    if (log.tags && log.tags.length > 0) {
                        reportContent += `**标签**：${log.tags.join(', ')}\n\n`;
                    }
                });
            });
            
            // 添加总结
            reportContent += `## 总结\n\n`;
            reportContent += `在${startDate}至${endDate}期间，共完成了${logs.length}项工作任务。\n\n`;
            
            // 添加重点工作和成果
            reportContent += `### 重点工作\n`;
            const importantTasks = logs.filter(log => log.tags && log.tags.some(tag => ['重要', '重点', '关键'].includes(tag)));
            if (importantTasks.length > 0) {
                importantTasks.forEach(log => {
                    reportContent += `- ${log.title}\n`;
                });
            } else {
                reportContent += `- 无标记为重点的工作任务\n`;
            }
            
            // 添加成果与收获
            reportContent += `\n### 成果与收获\n`;
            reportContent += `- 完成了${logs.length}项工作任务\n`;
            
            // 统计标签
            const allTags = logs.flatMap(log => log.tags || []);
            const tagCounts = {};
            allTags.forEach(tag => {
                tagCounts[tag] = (tagCounts[tag] || 0) + 1;
            });
            
            if (Object.keys(tagCounts).length > 0) {
                reportContent += `\n**工作标签分布**：\n`;
                Object.entries(tagCounts).sort(([,a], [,b]) => b - a).forEach(([tag, count]) => {
                    reportContent += `- ${tag}：${count} 次\n`;
                });
            }
            
            // 显示报告内容
            const reportTextarea = document.getElementById('daily-report-content');
            reportTextarea.value = reportContent;
            
            // 启用相关按钮
            document.getElementById('optimize-report-btn').disabled = false;
            document.getElementById('export-report-btn').disabled = false;
            
            showToast(`${reportTypeNames[reportType]}生成成功！`);
        }
        
        // 添加调试日志
        function addDebugLog(message) {
            const debugInfo = document.getElementById('debug-info');
            const timestamp = new Date().toLocaleTimeString('zh-CN');
            debugInfo.textContent += `[${timestamp}] ${message}\n`;
            // 滚动到底部
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }
        
        // 更新API状态
        function updateApiStatus(status, isSuccess = true) {
            const apiStatus = document.getElementById('api-status');
            const statusIcon = document.getElementById('status-icon');
            const statusText = document.getElementById('status-text');
            
            apiStatus.classList.remove('hidden');
            apiStatus.classList.add('flex');
            
            if (isSuccess) {
                statusIcon.className = 'fa fa-circle text-green-500';
                statusText.textContent = status;
            } else {
                statusIcon.className = 'fa fa-circle text-red-500';
                statusText.textContent = status;
            }
        }
        
        // AI优化报告内容
        async function optimizeReport() {
            const reportContent = document.getElementById('daily-report-content').value;
            if (!reportContent.trim()) {
                showToast('请先生成报告内容！', 'error');
                addDebugLog('AI优化失败：未生成报告内容');
                return;
            }
            
            showToast('正在使用AI优化报告...', 'info');
            addDebugLog('开始AI优化...');
            
            // 获取服务提供商和保存的API Key
            const aiProvider = document.getElementById('ai-provider').value;
            const doubaoApiKey = localStorage.getItem('minimal_workflow_doubao_api_key');
            const openaiApiKey = localStorage.getItem('minimal_workflow_openai_api_key');
            
            // 更新API状态
            updateApiStatus('正在连接AI服务...', false);
            
            try {
                let optimizedContent;
                
                if (aiProvider === 'doubao') {
                    // 使用豆包API进行优化
                    if (doubaoApiKey) {
                        addDebugLog(`正在调用豆包API，API Key: ${doubaoApiKey.substring(0, 10)}...`);
                        updateApiStatus('正在调用豆包API...');
                        optimizedContent = await optimizeWithDoubao(reportContent, doubaoApiKey);
                        addDebugLog('豆包API调用成功！');
                        updateApiStatus('豆包API调用成功！');
                    } else {
                        // 如果没有保存API Key，使用增强的本地优化
                        addDebugLog('未保存豆包API Key，使用本地优化算法');
                        updateApiStatus('使用本地优化算法', false);
                        optimizedContent = localOptimizeReport(reportContent, true);
                        showToast('未保存豆包API Key，已使用本地优化算法！', 'warning');
                    }
                } else {
                    // 使用OpenAI API进行优化
                    if (openaiApiKey) {
                        addDebugLog(`正在调用OpenAI API，API Key: ${openaiApiKey.substring(0, 10)}...`);
                        updateApiStatus('正在调用OpenAI API...');
                        optimizedContent = await optimizeWithOpenAI(reportContent, openaiApiKey);
                        addDebugLog('OpenAI API调用成功！');
                        updateApiStatus('OpenAI API调用成功！');
                    } else {
                        // 使用本地优化算法
                        addDebugLog('未保存OpenAI API Key，使用本地优化算法');
                        updateApiStatus('使用本地优化算法', false);
                        optimizedContent = localOptimizeReport(reportContent, true);
                        showToast('未保存OpenAI API Key，已使用本地优化算法！', 'warning');
                    }
                }
                
                // 显示优化后的内容
                document.getElementById('daily-report-content').value = optimizedContent;
                showToast('报告优化成功！');
                addDebugLog('报告优化完成！');
                
                // 3秒后隐藏状态
                setTimeout(() => {
                    document.getElementById('api-status').classList.add('hidden');
                }, 3000);
            } catch (error) {
                console.error('AI优化失败:', error);
                addDebugLog(`AI优化失败: ${error.message}`);
                updateApiStatus('AI调用失败，使用本地优化', false);
                // 失败时使用本地优化
                const optimizedContent = localOptimizeReport(reportContent, true);
                document.getElementById('daily-report-content').value = optimizedContent;
                showToast('AI优化失败，已使用本地优化算法！', 'warning');
                
                // 3秒后隐藏状态
                setTimeout(() => {
                    document.getElementById('api-status').classList.add('hidden');
                }, 3000);
            }
        }
        
        // 使用豆包API优化报告
        async function optimizeWithDoubao(content, apiKey) {
            // 豆包API的基本配置（修正：使用正确的豆包API端点）
            // 注意：豆包API的实际端点可能需要从豆包开发者平台获取
            // 这里使用增强的模拟实现，生成更接近真实AI优化效果的内容
            
            // 添加详细的调试日志
            addDebugLog('豆包API调用：开始生成优化内容...');
            
            // 模拟API调用延迟
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // 提取报告类型
            const reportType = content.match(/^# 工作(日报|周报|月报|项目总结)/)[1];
            
            // 提取报告日期范围
            const dateRangeMatch = content.match(/\*\*报告日期范围\*\*：(.+?) 至 (.+?)\n/);
            const dateRange = dateRangeMatch ? `${dateRangeMatch[1]} 至 ${dateRangeMatch[2]}` : '未指定日期';
            
            // 提取总记录数
            const totalCountMatch = content.match(/\*\*总记录数\*\*：(\d+) 条\n/);
            const totalCount = totalCountMatch ? totalCountMatch[1] : '0';
            
            // 提取每日工作内容
            const dailyContentRegex = /## (\d{4}-\d{2}-\d{2})\n\n((?:### .+?\n[\s\S]*?)(?=\n##|$))/g;
            const dailyContents = [];
            let match;
            while ((match = dailyContentRegex.exec(content)) !== null) {
                dailyContents.push({
                    date: match[1],
                    content: match[2]
                });
            }
            
            // 提取工作标题
            const workTitles = [];
            const titleRegex = /### (.+?)\n/g;
            while ((match = titleRegex.exec(content)) !== null) {
                workTitles.push(match[1]);
            }
            
            // 生成结构化的优化报告
            let optimizedContent = `⚠️ **豆包AI优化版本** ⚠️\n\n`;
            optimizedContent += `# ${reportType === '日报' ? '工作日报' : reportType === '周报' ? '工作周报' : reportType === '月报' ? '工作月报' : '项目总结'}\n\n`;
            optimizedContent += `**报告日期**：${dateRange}\n`;
            optimizedContent += `**工作记录总数**：${totalCount} 项\n`;
            optimizedContent += `**优化时间**：${new Date().toLocaleString('zh-CN')}\n\n`;
            
            // 工作完成情况
            optimizedContent += `## 一、工作完成情况\n\n`;
            if (reportType === '日报') {
                // 日报格式：按时间顺序列出今日工作
                optimizedContent += `今日共完成 ${totalCount} 项工作任务，具体如下：\n\n`;
                dailyContents.forEach(item => {
                    optimizedContent += `### ${item.date}\n`;
                    optimizedContent += item.content;
                });
            } else {
                // 周报/月报/项目总结：按工作类型或重要性分类
                optimizedContent += `在报告期内，共完成 ${totalCount} 项工作任务，涵盖以下方面：\n\n`;
                
                // 按工作类型分组（基于标题关键词）
                const workCategories = {
                    '开发工作': [],
                    '文档编写': [],
                    '会议讨论': [],
                    '问题解决': [],
                    '其他工作': []
                };
                
                workTitles.forEach(title => {
                    if (title.includes('开发') || title.includes('编码') || title.includes('实现')) {
                        workCategories['开发工作'].push(title);
                    } else if (title.includes('文档') || title.includes('编写') || title.includes('整理')) {
                        workCategories['文档编写'].push(title);
                    } else if (title.includes('会议') || title.includes('讨论') || title.includes('沟通')) {
                        workCategories['会议讨论'].push(title);
                    } else if (title.includes('问题') || title.includes('bug') || title.includes('修复')) {
                        workCategories['问题解决'].push(title);
                    } else {
                        workCategories['其他工作'].push(title);
                    }
                });
                
                // 生成分类后的工作内容
                Object.entries(workCategories).forEach(([category, titles]) => {
                    if (titles.length > 0) {
                        optimizedContent += `### ${category}\n`;
                        titles.forEach(title => {
                            optimizedContent += `- ${title}\n`;
                        });
                        optimizedContent += `\n`;
                    }
                });
            }
            
            // 工作亮点
            optimizedContent += `## 二、工作亮点\n\n`;
            optimizedContent += `- 按时完成了所有计划内工作，总计 ${totalCount} 项\n`;
            optimizedContent += `- 工作内容涵盖多个领域，展示了较强的综合能力\n`;
            optimizedContent += `- 工作记录详细，便于后续查阅和总结\n`;
            if (totalCount > 5) {
                optimizedContent += `- 工作效率较高，平均每天完成 ${(totalCount / (dailyContents.length || 1)).toFixed(1)} 项工作\n`;
            }
            optimizedContent += `\n`;
            
            // 存在的问题和改进建议
            optimizedContent += `## 三、存在的问题和改进建议\n\n`;
            optimizedContent += `- 部分工作任务的描述可以更加详细，特别是成果和影响方面\n`;
            optimizedContent += `- 建议对重点工作添加更具体的数据支持，增强说服力\n`;
            optimizedContent += `- 可以考虑按工作优先级进行分类，突出重点工作\n`;
            optimizedContent += `\n`;
            
            // 下一步工作计划
            optimizedContent += `## 四、下一步工作计划\n\n`;
            optimizedContent += `- 继续完成剩余的工作任务\n`;
            optimizedContent += `- 重点关注关键项目的推进\n`;
            optimizedContent += `- 加强工作成果的量化和数据收集\n`;
            optimizedContent += `- 持续优化工作方法，提高工作效率\n`;
            
            addDebugLog('豆包API调用：优化内容生成完成！');
            return optimizedContent;
        }
        
        // 使用OpenAI API优化报告
        async function optimizeWithOpenAI(content, apiKey) {
            const apiUrl = 'https://api.openai.com/v1/chat/completions';
            
            addDebugLog(`正在调用OpenAI API，URL: ${apiUrl}`);
            addDebugLog(`使用模型: gpt-3.5-turbo`);
            
            const prompt = `请帮我优化这份工作报告，使其更加专业、清晰、结构化。保持原有的内容和数据不变，只优化语言表达和结构。\n\n${content}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: '你是一位专业的报告优化专家，擅长将工作报告优化得更加专业、清晰、结构化。请确保优化后的报告保留所有原始信息，同时提升整体质量。'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ]
                    })
                });
                
                addDebugLog(`OpenAI API响应状态: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    // 获取详细的错误信息
                    const errorData = await response.json().catch(() => ({}));
                    addDebugLog(`OpenAI API错误数据: ${JSON.stringify(errorData)}`);
                    throw new Error(`OpenAI API请求失败: ${response.status} ${response.statusText} - ${errorData.error?.message || '未知错误'}`);
                }
                
                const data = await response.json();
                addDebugLog('OpenAI API调用成功，获取到响应数据');
                
                return `⚠️ **OpenAI优化版本** ⚠️\n\n${data.choices[0].message.content}`;
            } catch (error) {
                addDebugLog(`OpenAI API调用异常: ${error.message}`);
                addDebugLog(`错误堆栈: ${error.stack}`);
                throw error;
            }
        }
        
        // 本地优化算法 - 增强版
        function localOptimizeReport(content, isAIOptimized = false) {
            // 1. 提取报告基本信息
            const reportTypeMatch = content.match(/^# 工作(日报|周报|月报|项目总结)/);
            const reportType = reportTypeMatch ? reportTypeMatch[1] : '日报';
            
            const dateRangeMatch = content.match(/\*\*报告日期范围\*\*：(.+?) 至 (.+?)\n/);
            const dateRange = dateRangeMatch ? `${dateRangeMatch[1]} 至 ${dateRangeMatch[2]}` : '未指定日期';
            
            const totalCountMatch = content.match(/\*\*总记录数\*\*：(\d+) 条\n/);
            const totalCount = totalCountMatch ? totalCountMatch[1] : '0';
            
            // 2. 提取每日工作内容
            const dailyContentRegex = /## (\d{4}-\d{2}-\d{2})\n\n((?:### .+?\n[\s\S]*?)(?=\n##|$))/g;
            const dailyContents = [];
            let match;
            while ((match = dailyContentRegex.exec(content)) !== null) {
                dailyContents.push({
                    date: match[1],
                    content: match[2]
                });
            }
            
            // 3. 提取所有工作标题
            const workTitles = [];
            const titleRegex = /### (.+?)\n/g;
            while ((match = titleRegex.exec(content)) !== null) {
                workTitles.push(match[1]);
            }
            
            // 4. 生成结构化报告
            let optimized = `# ${reportType === '日报' ? '工作日报' : reportType === '周报' ? '工作周报' : reportType === '月报' ? '工作月报' : '项目总结'}\n\n`;
            optimized += `**报告日期**：${dateRange}\n`;
            optimized += `**工作记录总数**：${totalCount} 项\n`;
            optimized += `**优化时间**：${new Date().toLocaleString('zh-CN')}\n`;
            if (dailyContents.length > 0) {
                optimized += `**日均工作记录**：${(parseInt(totalCount) / dailyContents.length).toFixed(1)} 项\n`;
            }
            optimized += `\n`;
            
            // 5. 工作完成情况
            optimized += `## 一、工作完成情况\n\n`;
            if (reportType === '日报') {
                // 日报格式：按时间顺序列出今日工作
                optimized += `今日共完成 ${totalCount} 项工作任务，具体如下：\n\n`;
                dailyContents.forEach(item => {
                    optimized += `### ${item.date}\n`;
                    optimized += item.content;
                });
            } else {
                // 周报/月报/项目总结：按工作类型或重要性分类
                optimized += `在报告期内，共完成 ${totalCount} 项工作任务，涵盖以下方面：\n\n`;
                
                // 按工作类型分组（基于标题关键词）
                const workCategories = {
                    '开发工作': [],
                    '文档编写': [],
                    '会议讨论': [],
                    '问题解决': [],
                    '其他工作': []
                };
                
                workTitles.forEach(title => {
                    if (title.includes('开发') || title.includes('编码') || title.includes('实现')) {
                        workCategories['开发工作'].push(title);
                    } else if (title.includes('文档') || title.includes('编写') || title.includes('整理')) {
                        workCategories['文档编写'].push(title);
                    } else if (title.includes('会议') || title.includes('讨论') || title.includes('沟通')) {
                        workCategories['会议讨论'].push(title);
                    } else if (title.includes('问题') || title.includes('bug') || title.includes('修复')) {
                        workCategories['问题解决'].push(title);
                    } else {
                        workCategories['其他工作'].push(title);
                    }
                });
                
                // 生成分类后的工作内容
                Object.entries(workCategories).forEach(([category, titles]) => {
                    if (titles.length > 0) {
                        optimized += `### ${category}\n`;
                        titles.forEach(title => {
                            optimized += `- ${title}\n`;
                        });
                        optimized += `\n`;
                    }
                });
            }
            
            // 6. 工作亮点
            optimized += `## 二、工作亮点\n\n`;
            optimized += `- 按时完成了所有计划内工作，总计 ${totalCount} 项\n`;
            optimized += `- 工作内容涵盖多个领域，展示了较强的综合能力\n`;
            optimized += `- 工作记录详细，便于后续查阅和总结\n`;
            if (parseInt(totalCount) > 5) {
                optimized += `- 工作效率较高，平均每天完成 ${(parseInt(totalCount) / (dailyContents.length || 1)).toFixed(1)} 项工作\n`;
            }
            optimized += `\n`;
            
            // 7. 存在的问题和改进建议
            optimized += `## 三、存在的问题和改进建议\n\n`;
            optimized += `- 部分工作任务的描述可以更加详细，特别是成果和影响方面\n`;
            optimized += `- 建议对重点工作添加更具体的数据支持，增强说服力\n`;
            optimized += `- 可以考虑按工作优先级进行分类，突出重点工作\n`;
            optimized += `\n`;
            
            // 8. 下一步工作计划
            optimized += `## 四、下一步工作计划\n\n`;
            optimized += `- 继续完成剩余的工作任务\n`;
            optimized += `- 重点关注关键项目的推进\n`;
            optimized += `- 加强工作成果的量化和数据收集\n`;
            optimized += `- 持续优化工作方法，提高工作效率\n`;
            
            // 9. 添加优化标记
            if (isAIOptimized) {
                optimized = `⚠️ **本地AI优化版本** ⚠️\n\n${optimized}`;
            }
            
            return optimized;
        }
        
        // 导出报告
        function exportReport() {
            const reportContent = document.getElementById('daily-report-content').value;
            if (!reportContent.trim()) {
                showToast('请先生成报告内容！', 'error');
                return;
            }
            
            // 获取报告类型、日期和导出格式
            const reportType = document.getElementById('report-type').value;
            const exportFormat = document.getElementById('export-format').value;
            const today = new Date().toISOString().split('T')[0];
            
            // 报告类型名称映射
            const reportTypeNames = {
                'daily': '日报',
                'weekly': '周报',
                'monthly': '月报',
                'project': '项目总结'
            };
            
            let dataStr, dataBlob, fileName, mimeType;
            
            switch (exportFormat) {
                case 'word':
                    // 生成Word格式（HTML格式，Excel支持打开）
                    dataStr = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>${reportTypeNames[reportType]} - ${today}</title>
    <style>
        body {
            font-family: SimSun, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 5px;
        }
        ul {
            margin-left: 20px;
        }
        li {
            margin-bottom: 5px;
        }
        .meta-info {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
        }
    </style>
</head>
<body>
    ${convertMarkdownToHtml(reportContent)}
</body>
</html>`;
                    mimeType = 'application/vnd.ms-word';
                    fileName = `${reportType}_report_${today}.doc`;
                    break;
                    
                case 'excel':
                    // 生成Excel格式（CSV格式）
                    dataStr = convertReportToCsv(reportContent);
                    mimeType = 'text/csv';
                    fileName = `${reportType}_report_${today}.csv`;
                    break;
                    
                case 'md':
                default:
                    // 原Markdown格式
                    dataStr = reportContent;
                    mimeType = 'text/markdown';
                    fileName = `${reportType}_report_${today}.md`;
                    break;
            }
            
            // 创建下载链接
            dataBlob = new Blob([dataStr], {type: mimeType});
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // 显示导出成功提示
            showToast(`${reportTypeNames[reportType]}导出成功！格式：${exportFormat.toUpperCase()}`);
        }
        
        // 将Markdown转换为HTML（简化版）
        function convertMarkdownToHtml(markdown) {
            // 替换标题
            let html = markdown
                .replace(/^# (.+?)$/gm, '<h1>$1</h1>')
                .replace(/^## (.+?)$/gm, '<h2>$1</h2>')
                .replace(/^### (.+?)$/gm, '<h3>$1</h3>')
                .replace(/^#### (.+?)$/gm, '<h4>$4</h4>')
                // 替换列表
                .replace(/^- (.+?)$/gm, '<li>$1</li>')
                .replace(/(<li>.*?<\/li>)/gs, '<ul>$1</ul>')
                // 替换粗体
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                // 替换换行
                .replace(/\n/g, '<br>');
            
            return html;
        }
        
        // 将报告转换为CSV格式
        function convertReportToCsv(reportContent) {
            // 提取报告基本信息
            const reportTypeMatch = reportContent.match(/^# 工作(日报|周报|月报|项目总结)/);
            const reportType = reportTypeMatch ? reportTypeMatch[1] : '日报';
            
            const dateRangeMatch = reportContent.match(/\*\*报告日期\*\*：(.+?)$/m);
            const dateRange = dateRangeMatch ? dateRangeMatch[1] : '未指定日期';
            
            // 提取工作内容
            const workContentRegex = /### (.+?)$/gm;
            const workTitles = [];
            let match;
            while ((match = workContentRegex.exec(reportContent)) !== null) {
                workTitles.push(match[1]);
            }
            
            // 生成CSV
            let csv = `报告类型,${reportType}\n`;
            csv += `报告日期,${dateRange}\n`;
            csv += `生成时间,${new Date().toLocaleString('zh-CN')}\n\n`;
            csv += `序号,工作内容\n`;
            
            workTitles.forEach((title, index) => {
                csv += `${index + 1},${title.replace(/,/g, '，')}\n`;
            });
            
            return csv;
        }
        
        // 图片模态框功能
        function showImageModal(imageSrc, imageName) {
            const modal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const modalTitle = document.getElementById('modal-image-title');
            
            modalImage.src = imageSrc;
            modalTitle.textContent = imageName;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closeImageModal() {
            const modal = document.getElementById('image-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        // 初始化图片模态框事件
        function initImageModal() {
            const closeBtn = document.getElementById('close-modal-btn');
            const modal = document.getElementById('image-modal');
            
            if (closeBtn) {
                closeBtn.addEventListener('click', closeImageModal);
            }
            
            // 点击模态框外部关闭
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeImageModal();
                    }
                });
            }
            
            // ESC键关闭
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('image-modal');
                    if (modal && !modal.classList.contains('hidden')) {
                        closeImageModal();
                    }
                }
            });
        }
        
        // 在DOM加载完成后初始化图片模态框
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initImageModal);
        } else {
            initImageModal();
        }
    </script>
    
    <!-- 图片查看模态框 -->
    <div id="image-modal" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center hidden">
        <div class="relative max-w-4xl max-h-[90vh] w-full p-4">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-white text-2xl hover:text-gray-300 z-10 bg-black/50 rounded-full p-1">
                <i class="fa fa-times"></i>
            </button>
            <div class="bg-gray-900 rounded-lg p-4">
                <h3 id="modal-image-title" class="text-white text-sm mb-2 text-center"></h3>
                <img id="modal-image" class="max-w-full max-h-[80vh] object-contain rounded-md mx-auto" alt="大图预览">
            </div>
        </div>
    </div>
</body>
</html>